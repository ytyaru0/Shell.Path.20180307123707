# このソフトウェアについて

シェルの相対パスについて調べる。

* 実行方法
    * 本プロセスとして (環境変数が変更された影響*あり*, `$0`=`/bin/bash`)
        * `$ . *.sh`
        * `$ source *.sh`
    * 子プロセスとして (環境変数が変更された影響*なし*, `$0`={スクリプトファイルパス})
        * `$ *.sh`
        * `$ bash *.sh`

* 呼び出し方
    * プロセス
        * 本プロセスとして (環境変数が変更された影響あり, `$0`=`/bin/bash`)
            * `$ . *.sh`
            * `$ source *.sh`
        * 子プロセスとして(環境変数が変更された影響なし, `$0`={スクリプトファイルパス})
            * `$ *.sh` (要実行権限)
            * `$ bash *.sh`
    * カレントディレクトリ
        * 対象スクリプトのルート
        * 対象スクリプトのルート以外


たとえば環境変数`PS1`を変更するスクリプトがあった場合、呼出元でもその変更結果を用いたいなら`.`, `source`で呼び出すべき。`*.sh`, `bash *.sh`で呼び出しても、その処理が終了したら変更も消えてしまう。

pythonのvenvにあるactivateスクリプトを`. activate`として実行すべき理由はこれ。変更した環境変数`PS1`を使いたいから。だと思う。

しかし問題がある。`. *.sh`としてターミナルで実行すると、`$0`が`/bin/bash`になる。スクリプトファイルパスが取得できない。スクリプトファイル内で別スクリプトを相対パスで参照したいが、できなくなる。

別スクリプトファイルで環境変数を設定させ、その影響を受けたい。かつ、`$0`はスクリプトファイルパスであって欲しい。どうするか。

* 呼出側は`. *.sh`とする

上記に加えて、以下のどれかでスクリプトパスを得る

A. 呼出側で引数としてスクリプトパスを渡す
B. スクリプト内で自分のフルパスをハードコーディングする

どちらも馬鹿馬鹿しい対応。

* ファイルパスを変更したくなることは多いが、その都度コードも変えねばならない
* 呼出側が`.`で実行したため、スクリプト内で`cd`してしまうとカレントディレクトリが変更されてしまう

影響が大きすぎる。




ターミナルを起動。カレントディレクトリは`/tmp`とし、`~/myscript/main.sh`を呼び出す。
```sh
/tmp $ ~/myscript/main.sh
```

`~/myscript/`配下には以下のようなファイルがある。

main.sh
```sh
echo "main: arg0=$0"
path=$(cd $(dirname $0); pwd)
cd $path

MAIN=MAIN
bash ./sub/sub1.sh
```
./sub/sub1.sh
```sh
echo "sub1: arg0=$0"
bash ./sub/subsub/subsub1.sh
```
./sub/subsub/subsub1.sh
```sh
echo "subsub1: arg0=$0"
```

これで相対パスで参照できる。

ただし、最初の呼出元で`.`, `source`コマンドを使った場合、失敗する。`$0`が`/bin/bash`になり`~/myscript/`に`cd`できないから。

```sh
/tmp $ . ~/myscript/main.sh
```










そんな場合はどうするか。ターミナルで`bash /A.sh`とし、`A.sh`内で`$0`によりスクリプトファイルパスを取得。スクリプト内でそこに`cd`する。その後、相対パスでほかのスクリプトを参照する。

`bash *.sh`のように子プロセスとして呼びだせば、`$0`にはスクリプトファイルパスが入る。それをrootディレクトリとする。`cd`すれば相対パスが使える。







実行方法|環境変数が変更された影響|スクリプト引数 $0
--------|------------------------|-----------------
本プロセスとして|受ける|`/bin/bash`
子プロセスとして|受けない|スクリプトファイルパス


実行方法|親が定義した変数を子が参照できるか|子が定義した変数を親が参照できるか|スクリプト引数 $0
--------|------------------------|-----------------
本プロセスとして|○|○|`/bin/bash`
子プロセスとして|✘|✘|スクリプトファイルパス

`.`, `source`はC言語でいう`#include <...>`的。ソースコードファイルを結合してからコンパイルする。コマンドを`include`に別名定義したらわかりやすくなるか？


実行方法            環境変数が変更された影響  カレントディレクトリ    コマンド
                                                                      `$ . *.sh`
本プロセスとして    受ける                    `/bin/bash`             `$ source *.sh`
子プロセスとして    受けない                  スクリプトファイルパス  `$ *.sh` (要実行権限)
                                                                      `$ bash *.sh`


実行方法            環境変数が変更された影響  カレントディレクトリ    コマンド
本プロセスとして    受ける                    `/bin/bash`             `$ . *.sh`
                                                                      `$ source *.sh`
子プロセスとして    受けない                  スクリプトファイルパス  `$ *.sh` (要実行権限)
                                                                      `$ bash *.sh`

実行方法           |環境変数が変更された影響 |カレントディレクトリ   |コマンド
-------------------|-------------------------|-----------------------|--------
本プロセスとして   |受ける                   |`/bin/bash`            |`$ . *.sh`
                   |                         |                       |`$ source *.sh`
子プロセスとして   |受けない                 |スクリプトファイルパス |`$ *.sh` (要実行権限)
                   |                         |                       |`$ bash *.sh`

https://qiita.com/nocd5/items/8521cb00107587a5189e

* 位置をどうするか
    * 方向 (横、縦)
        * 寄せ（左右、上下、中央）
* ヘッダ項目をどうするか
    * 一般的
        * 表: 一行目のみ
        * 表: 一列目のみ
        * Matrix: 一行目と一列目
    * 非一般的
        * 奇数、偶数の行、列（段組）
        * 任意の行、列、セル


以下のような場合、`x月`はヘッダ列、`○`はデータ列にしたい。

1月|○| 7月|○
2月|○| 8月|○
3月|○| 9月|○
4月|○|10月|○
5月|○|11月|○
6月|○|12月|○

上記のような表は段組として設定できるべき。`<table>`は以下のように定義してあるが、縦6件以降は右側に表示するようにする、とか。

1月|○
2月|○
3月|○
4月|○
5月|○
6月|○
7月|○
8月|○
9月|○
10月|○
11月|○
12月|○

縦方向は中央寄せで確定させると楽。横方向は数値なら右、テキストなら左が一般的。

名前  |戦闘力 |所持金(円)|  一言    
------|------:|---------:|:---------:
山田  |      5|         0|  おっす
鈴木  |530,000|       300|ほっほっほ



そもそも、セル結合テーブルとは何なのか？

実行方法           |環境変数が変更された影響 |`$0`の値               |コマンド
-------------------|-------------------------|-----------------------|--------
本プロセスとして   |受ける                   |`/bin/bash`            |`$ . *.sh`
                   |                         |                       |`$ source *.sh`
子プロセスとして   |受けない                 |スクリプトファイルパス |`$ *.sh` (要実行権限)
                   |                         |                       |`$ bash *.sh`

`$ . *.sh`    `$ source *.sh`
    |______________|
          |
    本プロセスとして
          |
        sh実行
          |
    子プロセスとして
          |
    |￣￣￣￣￣￣￣|
`$ bash *.sh`   `$ *.sh` (要実行権限)

                             +--`$ . *.sh`
        +--本プロセスとして--+--`$ source *.sh`
sh実行--+
        +--子プロセスとして--+--`$ *.sh`
                             +--`$ bash *.sh`
        
決定木。分岐を端的に表せる。が、以下の情報が不足。

実行方法|環境変数が変更された影響|スクリプト引数 $0
--------|------------------------|-----------------
本プロセスとして|受ける|`/bin/bash`
子プロセスとして|受けない|スクリプトファイルパス

実行方法|親が定義した変数を子が参照できるか|子が定義した変数を親が参照できるか|スクリプト引数 $0
--------|------------------------|-----------------
本プロセスとして|○|○|`/bin/bash`
子プロセスとして|✘|✘|スクリプトファイルパス

セル結合テーブルとは、決定木とマトリクスの組み合わせだった。

* 順序
* 構造
    * 集合
    * 包含
    * ピラミッド
* 分岐
* 表

実行方法           |環境変数が変更された影響 |`$0`の値               |
-------------------|-------------------------|-----------------------|
本プロセスとして   |受ける                   |`/bin/bash`            |
子プロセスとして   |受けない                 |スクリプトファイルパス |

この2つを一挙に表示するのがセル結合テーブル。











```sh
$ 
```

# 課題

# 参考

* 

# 開発環境

* [Raspberry Pi](https://ja.wikipedia.org/wiki/Raspberry_Pi) 3 Model B
    * [Raspbian](https://www.raspberrypi.org/downloads/raspbian/) GNU/Linux 8.0 (jessie)
        * bash 4.3.30

# ライセンス

このソフトウェアはCC0ライセンスである。

[![CC0](http://i.creativecommons.org/p/zero/1.0/88x31.png "CC0")](http://creativecommons.org/publicdomain/zero/1.0/deed.ja)

